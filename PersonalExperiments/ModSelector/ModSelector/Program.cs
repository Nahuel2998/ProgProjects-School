using System;
using System.IO;

namespace ModSelector
{
    class Program
    {
        private static void Main(string[] args)
        {
            if (new Random().Next(21, 63) == 42)
            {
                Console.WriteLine("I don't feel like running.");
                Console.ReadKey();
                return;
            }
            Console.WriteLine(@".°*°...o°**°....°°......°******°°..°°.°****°...° .....°°°°°°°.. ............ ...
..*°...*°**°....°°......°**°°°*°.......°°°°....° ....°°°°°°°°.. ............ ...
..*°...*°**°....°°......°*******°  .°°°°°°°....  ....°*°°°°°°.. ............ ... 
..°°...*°°*°....°°....°..°°°°°°.  *OOOOOOOOoooo*  ....°°°°°°°°. ............ ... 
..°°...*°°*°..°...    ....°°°°°°°°oooooooooooooO°............     .......... ... 
..°°...****°..  .**oo***oooOOOOOOOoooOOOOOoooooooOoOOoooooooo*°*o°.  ....... ... 
..°°...*°°....°*OOOOOOOOOooooooooooOOOOOOOOOOOOOOoooooooooOOOOOOOOOo*.. .... ... 
..°°.  ..°*ooOOOooooooooooooOOOOOOOO#############OoOoooooooooooooooOOOo°  .. ... 
.... .°*oOOOoooooOOOOOOOOOOOO####################OOOOOOOOOOOOOOOOooooooO°    ... 
. .°oOOOoooooooooO########################################Oo*°°**oOOoooO° ...... 
.*oOOooooooooOOOO###################################O###o°.       .*oOoO° ...... 
oOoooooooOOOOO####################################O##Oo°    .°°°°°...*oO° ...... 
ooooOOOOOO#########################################O*.  ..*oO######Oo**O° ...... 
ooOOOOO###OO#####################################O*.  .*oO###OOOOOOOOOOO° ...... 
oOo°. .°*O#####################################O*   .*OOO######OOOOOOOOO..°..... 
O*..°..   °o###########################ooOOOo*°  .°oOOOO#######OOOOOOOOO..°..... 
ooO###OO*°  .*O########################O*.     °oOOOOO#########OOOOOOOOO..°°.... 
O#OOOO###OO*. .°o#####OOO################OOoooOOOOOO###########OOOOOOOOO..°°.... 
OOOOO#######Oo°. ..°°°°oO##################OOOOOOO########OO#####OOOOOOO..°°. .. 
OOOOO#########OOo**°*oOO####################OOOOOoo**°°°******ooOOOOOOOO..°°. .. 
OOOO############OOOOOOOO####################OOo***°*************oooOOOOO.°°°. .. 
OOOO######OOOoooOOOOOOO####################OOOOOOOOOOOOOO##OOOOOoooooOOO.°°°. .. 
OOOO###OOo**°°°°°°°*oO#####################OOo°.        ...°°°**ooOOOOOO.°°°. .. 
*OOOOOoooooooo*****°°*o####################O*.   ...               .°*oo.°°°. .. 
°OOOOOOOOOo*°.    ..°*oO####################o.°ooOO* ......           .o.°°°. .. 
.OOO##Oo°              *O##################o°oOOOO#°.#o........ °o*.   ..°°°. .. 
oOOO*.       .....  °..o##################OO#O###@°*@@. ...... °OOO*  *.°°°. .. 
*OO*   .*o° °...... *Oo*O######################@##°.#o ....... .OOOO.oo.°°°. .. 
.OO°  *OOO.°@o .... °#OOO#########################° °°o....... °@#O**#o.°°°. .. 
o°  °OOO#°°@o .... .@#O#######################@@@° °*o... .**.°#@#oOOo.°°°. .. 
. *oo °O##@* °°°...°°.#########################OO##* ****°.°*oOoO@#oOOOo.°°°. .. 
. °O#o°O@##o ..°.. *OO@########################Oo**.  °*ooooo*°.O*.oOOO*.°°°. .. 
. .OO#oO@#@O °°...°*..oO###########################Oo*°...°°°.   °*oOOO*.°°°. .. 
.. OO##O@@##° ***°°°°*O################################Oo*°°..°*°O#OOOO*.°°°. .. 
.. *O#O°°#@@O  .°°oO#############################################O#OOOO*.°°°. .. 
.. °O#OO*.°*° °oO##################################################OOOO*.°°°.... 
.. .OO##O°* .O#####################################################OOOO*.°°°.... 
..  O###O##o#######################################################OOOO°.°°° ... 
... o##############################################################OOOO°.°°° ... 
... *##############################################################OOOO°°°°° ... 
... *##############################################################OOOO°°°°° ... 
... °###############################################################OOO°°°°° ... 
... °###############################################################OOO.°°°° ... 
... .O##############################################################OOO.°°°° ... 
... .O######################o######################################OOOO.°°°° ... 
...  O#####################O*######################################OOOO.°°°° ... 
...  O#####################*o######################################OOOO.°°°° ... 
.... o#####################OO######################################OOOo.°°°. ... 
.... o#####################OO######################################OOOo.°°°. ... 
.... o######################O######################################OOOo.°°°. ... 
.... *#############################################################OOOo.°°°. ... 
.... *#############################################################OOOo.°°°. ... 
.... °############################################################OOOO*.°°°. ... 
.... °############################################################OOOO*.°°°. ... 
.... .############################################################OOOO*°°°°. ... 
......O###########################################################OOOO°°°°°. ..° 
..... o###########################################################OOOO°°°°°....° 
..... *##########################################################OOOOO°°°°° ...° 
..... .##########################################################OOOOO°°°°° ...° 
...... O##########################################OO############OOOOOO°°°°° ...° 
...... *#########################################O*O############OOOOOO.°°°° ...° 
...... .########################################o.*############OOOOOOO.°°°° ...° 
....... o#################OO#######OOOOOOOOOOOo*.*O############OOOOOOO.*°°° ...° 
....... .#################O*°oOOOOoooooooooo****O#############OOOOOOOo.*°°° ...° 
........ o#################O°°°*ooOO###OOOOOO#################OOOOOOOo.*°°° ...° 
........ .O###################################################OOOOOOOo.*°°. ...° 
......... °##################################################OOOOOOOOo.*°°. ..°° 
.........  *#################################################OOOOOOOO*.*°°. ..°° 
......... . o######################O*OOO####################OOOOOOOOO .*°°. ..°° 
......... .. o#####################O**ooOO#################OOOOOOOOO° °*°°. ..°° 
......... ... o#####################OOOOO##################OOOOOOOO*°°°*°°....°° 
......... .... *#####################OOO##################OOOOOOOO*.o.°*°°....°° 
......... ..... *########################################OOOOOOOO*.*o.°*°° ...°° 
......... ...... °######################################OOOOOOOO*.*oo.°*°° ...°° 
......... ....... .O####################################OOOOOOO*.*o*o.**°° ...°° 
........  ........  O##################################OOOOOOO°.oooo*.**°° ...°° 
........  .........  *################################OOOOOOO°°ooo*o*.*°°° ..°°° 
........  ........ .. °##############################OOOOOOo.°oo*°°°*.*°°° ..°°° 
........  ........  .. .o###########################OOOOOO*.*ooo°*o*..*°°. ..°°° 
........  ........  ...  *#########################OOOOOO° *o***°ooo..*°°. ..°°°");
            UiHandler.Instance.TrackDosPlayer.Load();
            UiHandler.Instance.PureFuriasPlayer.Load();
            
            string[] paths = {
                $@"{Environment.CurrentDirectory}\TheList.txt", // TheList Path
                $@"{Environment.CurrentDirectory}\unusedMods", // Unused Mods Folder
                $@"{Environment.CurrentDirectory}\mods"  // Used Mods Folder
            };
            ref string theListPath = ref paths[0];
            ref string unusedModsFolder = ref paths[1];
            ref string usedModsFolder = ref paths[2];
            
            for (int i = 0; i < args.Length; i++)
            { paths[i] = args[i]; }

            try
            {
                string[] arrLine = File.ReadAllLines($@"{usedModsFolder}\..\..\ColdClientLoader.ini");
                if (!(arrLine[4].EndsWith('l') || arrLine[4].EndsWith('2')))
                { arrLine[4] += " -bettercontrol"; }

                File.WriteAllLines($@"{usedModsFolder}\..\..\ColdClientLoader.ini", arrLine);
            }
            catch (Exception)
            { /* ignored */ }

            try
            { ModSelector.Instance.InitMods(theListPath, unusedModsFolder, usedModsFolder); }
            catch (Exception e)
            {
                Console.WriteLine(e);
                Console.ReadKey();
                return;
            }
            
            UiHandler.Instance.TrackDosPlayer.PlayLooping();
            UiHandler.Instance.UnusedModsFolder = unusedModsFolder;
            UiHandler.Instance.UsedModsFolder = usedModsFolder;
            UiHandler.Instance.BuildMenu();
        }
    }
}
